"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.loadStylableConfigEsm = exports.loadStylableConfig = void 0;
const find_config_1 = __importDefault(require("find-config"));
const url_1 = require("url");
function loadStylableConfig(context, extract) {
    const path = (0, find_config_1.default)('stylable.config.js', { cwd: context }) ??
        (0, find_config_1.default)('stylable.config.cjs', { cwd: context });
    let config;
    if (path) {
        try {
            config = require(path);
        }
        catch (e) {
            throw new Error(`Failed to load "stylable.config.js" from ${path}\n${e?.stack}`);
        }
        if (!config) {
            throw new Error(`Stylable configuration loaded from ${path} but no exported configuration found`);
        }
        return {
            path,
            config: extract(config),
        };
    }
    return undefined;
}
exports.loadStylableConfig = loadStylableConfig;
// use eval to preserve esm import from typescript compiling
// it to require, because of our current build to cjs
const esmImport = eval(`(path) => import(path)`);
async function loadStylableConfigEsm(context, extract) {
    const path = (0, find_config_1.default)('stylable.config.js', { cwd: context }) ??
        (0, find_config_1.default)('stylable.config.mjs', { cwd: context });
    let config;
    if (path) {
        try {
            config = await esmImport((0, url_1.pathToFileURL)(path));
        }
        catch (e) {
            throw new Error(`Failed to load "stylable.config.js" from ${path}\n${e?.stack}`);
        }
        if (!config) {
            throw new Error(`Stylable configuration loaded from ${path} but no exported configuration found`);
        }
        return {
            path,
            config: extract(config),
        };
    }
    return undefined;
}
exports.loadStylableConfigEsm = loadStylableConfigEsm;
//# sourceMappingURL=load-stylable-config.js.map